<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:PocketFence_Simple.Models"
             xmlns:local="clr-namespace:PocketFence_Simple"
             x:Class="PocketFence_Simple.FilterPage"
             x:DataType="local:FilterPage"
             x:Name="FilterPageRoot"
             Title="Content Filter">
    <ScrollView>
        <StackLayout Padding="20">
            <Label Text="Content Filter Rules" 
                   FontSize="Large" 
                   FontAttributes="Bold" 
                   Margin="0,0,0,20" />
            
            <!-- Filter Controls -->
            <Frame BackgroundColor="LightBlue" Margin="0,0,0,20">
                <StackLayout>
                    <Label Text="Global Filter Settings" FontSize="16" FontAttributes="Bold" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <Label Grid.Column="0" Text="Enable Content Filtering" VerticalTextAlignment="Center" />
                        <Switch Grid.Column="1" IsToggled="{Binding IsFilteringEnabled}" />
                    </Grid>
                </StackLayout>
            </Frame>
            
            <!-- Add New Rule Section -->
            <Frame BackgroundColor="LightGreen" Margin="0,0,0,20">
                <StackLayout>
                    <Label Text="Add New Rule" FontSize="16" FontAttributes="Bold" />
                    
                    <Entry Placeholder="Domain or URL to block (e.g., facebook.com)" 
                           Text="{Binding NewRulePattern}" />
                    
                    <Picker Title="Rule Type" SelectedItem="{Binding NewRuleType}">
                        <Picker.ItemsSource>
                            <x:Array Type="{x:Type x:String}">
                                <x:String>Domain</x:String>
                                <x:String>URL</x:String>
                                <x:String>Keyword</x:String>
                            </x:Array>
                        </Picker.ItemsSource>
                    </Picker>
                    
                    <Entry Placeholder="Description (optional)" 
                           Text="{Binding NewRuleDescription}" />
                    
                    <Button Text="Add Rule" 
                            Command="{Binding AddRuleCommand}" 
                            BackgroundColor="Green" 
                            TextColor="White" />
                </StackLayout>
            </Frame>
            
            <!-- Filter Categories -->
            <Label Text="Quick Categories" FontSize="16" FontAttributes="Bold" Margin="0,0,0,10" />
            <Grid Margin="0,0,0,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                <Button Grid.Row="0" Grid.Column="0" 
                        Text="Block Social Media" 
                        Command="{Binding BlockSocialMediaCommand}"
                        Margin="0,0,5,5" />
                        
                <Button Grid.Row="0" Grid.Column="1" 
                        Text="Block Gaming" 
                        Command="{Binding BlockGamingCommand}"
                        Margin="5,0,0,5" />
                        
                <Button Grid.Row="1" Grid.Column="0" 
                        Text="Block Adult Content" 
                        Command="{Binding BlockAdultContentCommand}"
                        Margin="0,5,5,0" />
                        
                <Button Grid.Row="1" Grid.Column="1" 
                        Text="Safe Search Only" 
                        Command="{Binding EnableSafeSearchCommand}"
                        Margin="5,5,0,0" />
            </Grid>
            
            <!-- Current Rules List -->
            <Label Text="Current Filter Rules" FontSize="16" FontAttributes="Bold" Margin="0,0,0,10" />
            <CollectionView ItemsSource="{Binding FilterRules}" 
                          BackgroundColor="Transparent"
                          x:DataType="local:FilterPage">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:FilterRule">
                        <Grid Padding="10" Margin="0,2">
                            <Frame BackgroundColor="White" Padding="15" HasShadow="True">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Pattern}" 
                                           FontSize="14" 
                                           FontAttributes="Bold" />
                                    
                                    <Switch Grid.Row="0" Grid.Column="1"
                                            IsToggled="{Binding IsEnabled}"
                                            VerticalOptions="Center" />
                                    
                                    <Button Grid.Row="0" Grid.Column="2"
                                            Text="Delete"
                                            BackgroundColor="Red"
                                            TextColor="White"
                                            FontSize="12"
                                            Padding="10,5"
                                            Clicked="OnDeleteRuleClicked"
                                            CommandParameter="{Binding Id}" />
                                    
                                    <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding RuleType, StringFormat='Type: {0}'}" 
                                           FontSize="12" 
                                           TextColor="Gray" />
                                    
                                    <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3"
                                           Text="{Binding Description}" 
                                           FontSize="12" 
                                           TextColor="DarkGray"
                                           IsVisible="{Binding Description, Converter={StaticResource StringNotNullOrEmptyConverter}}" />
                                </Grid>
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            
            <!-- Statistics -->
            <Frame BackgroundColor="LightYellow" Margin="0,20,0,0">
                <StackLayout>
                    <Label Text="Filter Statistics" FontSize="16" FontAttributes="Bold" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <StackLayout Grid.Column="0">
                            <Label Text="{Binding TotalRules}" FontSize="20" FontAttributes="Bold" HorizontalTextAlignment="Center" />
                            <Label Text="Total Rules" FontSize="12" HorizontalTextAlignment="Center" />
                        </StackLayout>
                        
                        <StackLayout Grid.Column="1">
                            <Label Text="{Binding ActiveRules}" FontSize="20" FontAttributes="Bold" HorizontalTextAlignment="Center" />
                            <Label Text="Active Rules" FontSize="12" HorizontalTextAlignment="Center" />
                        </StackLayout>
                    </Grid>
                </StackLayout>
            </Frame>
            
            <!-- Import/Export -->
            <StackLayout Orientation="Horizontal" Margin="0,20,0,0">
                <Button Text="Import Rules" 
                        Command="{Binding ImportRulesCommand}" 
                        HorizontalOptions="FillAndExpand" />
                <Button Text="Export Rules" 
                        Command="{Binding ExportRulesCommand}" 
                        HorizontalOptions="FillAndExpand"
                        Margin="10,0,0,0" />
            </StackLayout>
        </StackLayout>
    </ScrollView>
</ContentPage>